(function($){"use strict";redux.field_objects=redux.field_objects||{};redux.field_objects.typography=redux.field_objects.typography||{};var selVals=[];var isSelecting=false;var default_params={width:'resolve',triggerChange:true,allowClear:true};$(document).ready(function(){});$(document).find('.redux-group-tab').find('.redux-container-typography').each(function(){$(this).on('redux/linked/color',function(event,index,value,colorNew){var color=(value.color!==undefined&&value.color!==true)?value.color:colorNew;try{$(this).find('.redux-typography-color').wpColorPicker('color',color)}catch(e){$(this).find('.redux-typography-color').val(color)}})});redux.field_objects.typography.init=function(selector){if(!selector){selector=$(document).find(".redux-group-tab:visible").find('.redux-container-typography:visible')}$(selector).each(function(){var el=$(this);var parent=el;if(!el.hasClass('redux-field-container')){parent=el.parents('.redux-field-container:first')}if(parent.is(":hidden")){return}if(parent.hasClass('redux-field-init')){parent.removeClass('redux-field-init')}else{return}var fontClear;el.each(function(){$(this).find('.redux-typography-container').each(function(){var family=$(this).find('.redux-typography-family');if(family.data('value')===undefined){family=$(this)}else if(family.data('value')!==""){$(family).val(family.data('value'))}var select2_handle=$(this).find('.select2_params');if(select2_handle.size()>0){var select2_params=select2_handle.val();select2_params=JSON.parse(select2_params);default_params=$.extend({},default_params,select2_params)}fontClear=Boolean($(this).find('.redux-font-clear').val());redux.field_objects.typography.select(family);window.onbeforeunload=null});$(this).find('.redux-typography').on('change',function(){redux.field_objects.typography.select($(this))});$(this).find('.redux-typography-size, .redux-typography-height, .redux-typography-word, .redux-typography-letter, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration').keyup(function(){redux.field_objects.typography.select($(this).parents('.redux-container-typography:first'))});$(this).find('.redux-typography-color').wpColorPicker({change:function(event,ui){redux_change($(this));$(this).val(ui.color.toString());redux.field_objects.typography.select($(this))}});$(this).find(".redux-typography-size").numeric({allowMinus:false});$(this).find(".redux-typography-height, .redux-typography-word, .redux-typography-letter").numeric({allowMinus:true});var data=[{id:'none',text:'none'}];$(this).find(".redux-typography-family").select2({matcher:function(term,text){return text.toUpperCase().indexOf(term.toUpperCase())===0},query:function(query){return window.Select2.query.local(data)(query)},initSelection:function(element,callback){var data={id:element.val(),text:element.val()};callback(data)},allowClear:fontClear,}).on("select2-opening",function(e){var thisID=$(this).parents('.redux-container-typography:first').attr('data-id');var isUserFonts=$('#'+thisID+' .redux-typography-font-family').data('user-fonts');isUserFonts=isUserFonts?1:0;var usingGoogleFonts=$('#'+thisID+' .redux-typography-google').val();usingGoogleFonts=usingGoogleFonts?1:0;var buildData=[];if(redux.customfonts!==undefined){buildData.push(redux.customfonts)}if(redux.stdfonts!==undefined&&isUserFonts===0){buildData.push(redux.stdfonts)}if(isUserFonts==1){var fontKids=[];for(var key in redux.typography[thisID]){var obj=redux.typography[thisID].std_font;for(var prop in obj){if(obj.hasOwnProperty(prop)){fontKids.push({id:prop,text:prop,'data-google':'false'})}}}var fontData={text:'Standard Fonts',children:fontKids};buildData.push(fontData)}if(usingGoogleFonts==1||usingGoogleFonts===true&&redux.googlefonts!==undefined){buildData.push(redux.googlefonts)}data=buildData;var selFamily=$('#'+thisID+' #'+thisID+'-family').attr('placeholder');if(!selFamily){selFamily=null}$('#'+thisID+" .redux-typography-family").select2('val',selFamily)}).on('select2-selecting',function(val,object){var fontName=val.object.text;var thisID=$(this).parents('.redux-container-typography:first').attr('data-id');$('#'+thisID+' #'+thisID+'-family').data('value',fontName);$('#'+thisID+' #'+thisID+'-family').attr('placeholder',fontName);selVals=val;isSelecting=true;redux_change($(this))}).on('select2-clearing',function(val,choice){var thisID=$(this).parents('.redux-container-typography:first').attr('data-id');$('#'+thisID+' #'+thisID+'-family').attr('data-value','');$('#'+thisID+' #'+thisID+'-family').attr('placeholder','Font Family');$('#'+thisID+' #'+thisID+'-google-font').val('false');redux_change($(this))});var xx=el.find(".redux-typography-family");if(!xx.hasClass('redux-typography-family')){el.find(".redux-typography-style").select2(default_params)}el.find(".redux-typography-family-backup, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").select2(default_params)})})};redux.field_objects.typography.size=function(obj){var size=0,key;for(key in obj){if(obj.hasOwnProperty(key)){size++}}return size};redux.field_objects.typography.makeBool=function(val){if(val=='false'||val=='0'||val===false||val===0){return false}else if(val=='true'||val=='1'||val===true||val==1){return true}};redux.field_objects.typography.contrastColour=function(hexcolour){var retVal='#444444';if(hexcolour!==''){hexcolour=hexcolour.replace('#','');var r=parseInt(hexcolour.substr(0,2),16);var g=parseInt(hexcolour.substr(2,2),16);var b=parseInt(hexcolour.substr(4,2),16);var res=((r*299)+(g*587)+(b*114))/1000;retVal=(res>=128)?'#444444':'#ffffff'}return retVal};redux.field_objects.typography.select=function(selector){var mainID=$(selector).parents('.redux-container-typography:first').attr('data-id');var family=$('#'+mainID+' #'+mainID+'-family').val();if(!family){family=null}var familyBackup=$('#'+mainID+' select.redux-typography-family-backup').val();var size=$('#'+mainID+' .redux-typography-size').val();var height=$('#'+mainID+' .redux-typography-height').val();var word=$('#'+mainID+' .redux-typography-word').val();var letter=$('#'+mainID+' .redux-typography-letter').val();var align=$('#'+mainID+' select.redux-typography-align').val();var transform=$('#'+mainID+' select.redux-typography-transform').val();var fontVariant=$('#'+mainID+' select.redux-typography-font-variant').val();var decoration=$('#'+mainID+' select.redux-typography-decoration').val();var style=$('#'+mainID+' select.redux-typography-style').val();var script=$('#'+mainID+' select.redux-typography-subsets').val();var color=$('#'+mainID+' .redux-typography-color').val();var units=$('#'+mainID).data('units');var google;if(isSelecting===true){google=redux.field_objects.typography.makeBool(selVals.object['data-google']);$('#'+mainID+' .redux-typography-google-font').val(google)}else{google=redux.field_objects.typography.makeBool($('#'+mainID+' .redux-typography-google-font').val())}if(!$('#'+mainID).hasClass('typography-initialized')){style=$('#'+mainID+' select.redux-typography-style').data('value');script=$('#'+mainID+' select.redux-typography-subsets').data('value');if(style!==""){style=String(style)}if(typeof(script)!==undefined){script=String(script)}}if(redux.fonts.google===undefined){google=false}var details='';if(google===true&&(family in redux.fonts.google)){details=redux.fonts.google[family]}else{details={'400':'Normal 400','700':'Bold 700','400italic':'Normal 400 Italic','700italic':'Bold 700 Italic'}}if($(selector).hasClass('redux-typography-subsets')){$('#'+mainID+' input.typography-subsets').val(script)}if($(selector).hasClass('redux-typography-family')){var html='<option value=""></option>';if(google===true){var selected="";$.each(details.variants,function(index,variant){if(variant.id===style||redux.field_objects.typography.size(details.variants)===1){selected=' selected="selected"';style=variant.id}else{selected=""}html+='<option value="'+variant.id+'"'+selected+'>'+variant.name.replace(/\+/g," ")+'</option>'});$('#'+mainID+' .redux-typography-style').select2("destroy");$('#'+mainID+' .redux-typography-style').html(html);$('#'+mainID+' .redux-typography-style').select2(default_params);selected="";html='<option value=""></option>';$.each(details.subsets,function(index,subset){if(subset.id===script||redux.field_objects.typography.size(details.subsets)===1){selected=' selected="selected"';script=subset.id;$('#'+mainID+' input.typography-subsets').val(script)}else{selected=""}html+='<option value="'+subset.id+'"'+selected+'>'+subset.name.replace(/\+/g," ")+'</option>'});$('#'+mainID+' .redux-typography-subsets').select2("destroy");$('#'+mainID+' .redux-typography-subsets').html(html);$('#'+mainID+' .redux-typography-subsets').select2(default_params);$('#'+mainID+' .redux-typography-subsets').parent().fadeIn('fast');$('#'+mainID+' .typography-family-backup').fadeIn('fast')}else{if(details){$.each(details,function(index,value){if(index===style||index==="normal"){selected=' selected="selected"';$('#'+mainID+' .typography-style .select2-chosen').text(value)}else{selected=""}html+='<option value="'+index+'"'+selected+'>'+value.replace('+',' ')+'</option>'});$('#'+mainID+' .redux-typography-style').select2("destroy");$('#'+mainID+' .redux-typography-style').html(html);$('#'+mainID+' .redux-typography-style').select2(default_params);$('#'+mainID+' .redux-typography-subsets').parent().fadeOut('fast');$('#'+mainID+' .typography-family-backup').fadeOut('fast')}}$('#'+mainID+' .redux-typography-font-family').val(family)}else if($(selector).hasClass('redux-typography-family-backup')&&familyBackup!==""){$('#'+mainID+' .redux-typography-font-family-backup').val(familyBackup)}if($('#'+mainID+" select.redux-typography-style option[value='"+style+"']").length===0){style="";$('#'+mainID+' select.redux-typography-style').select2('val','')}else if(style==="400"){$('#'+mainID+' select.redux-typography-style').select2('val',style)}if($('#'+mainID+" select.redux-typography-subsets option[value='"+script+"']").length===0){script="";$('#'+mainID+' select.redux-typography-subsets').select2('val','');$('#'+mainID+' input.typography-subsets').val(script)}var _linkclass='style_link_'+mainID;$('.'+_linkclass).remove();if(family!==null&&family!=="inherit"&&$('#'+mainID).hasClass('typography-initialized')){var the_font=family.replace(/\s+/g,'+');if(google===true){var link=the_font;if(style){link+=':'+style.replace(/\-/g," ")}if(script){link+='&subset='+script}if(typeof(WebFont)!=="undefined"&&WebFont){WebFont.load({google:{families:[link]}})}$('#'+mainID+' .redux-typography-google').val(true)}else{$('#'+mainID+' .redux-typography-google').val(false)}}if(style.indexOf("italic")!==-1){$('#'+mainID+' .typography-preview').css('font-style','italic');$('#'+mainID+' .typography-font-style').val('italic');style=style.replace('italic','')}else{$('#'+mainID+' .typography-preview').css('font-style',"normal");$('#'+mainID+' .typography-font-style').val('')}$('#'+mainID+' .typography-font-weight').val(style);if(!height){height=size}if(size===''){$('#'+mainID+' .typography-font-size').val('')}else{$('#'+mainID+' .typography-font-size').val(size+units)}if(height===''){$('#'+mainID+' .typography-line-height').val('')}else{$('#'+mainID+' .typography-line-height').val(height+units)}if(word===''){$('#'+mainID+' .typography-word-spacing').val('')}else{$('#'+mainID+' .typography-word-spacing').val(word+units)}if(letter===''){$('#'+mainID+' .typography-letter-spacing').val('')}else{$('#'+mainID+' .typography-letter-spacing').val(letter+units)}if($('#'+mainID).hasClass('typography-initialized')){var isPreviewSize=$('#'+mainID+' .typography-preview').data('preview-size');if(isPreviewSize=='0'){$('#'+mainID+' .typography-preview').css('font-size',size+units)}$('#'+mainID+' .typography-preview').css('font-weight',style);$('#'+mainID+' .typography-preview').css('font-family',family+', sans-serif');if(family==='none'&&family===''){$('#'+mainID+' .typography-preview').css('font-family','inherit')}$('#'+mainID+' .typography-preview').css('line-height',height+units);$('#'+mainID+' .typography-preview').css('word-spacing',word+units);$('#'+mainID+' .typography-preview').css('letter-spacing',letter+units);if(color){$('#'+mainID+' .typography-preview').css('color',color);$('#'+mainID+' .typography-preview').css('background-color',redux.field_objects.typography.contrastColour(color))}$('#'+mainID+' .typography-style .select2-chosen').text($('#'+mainID+' .redux-typography-style option:selected').text());$('#'+mainID+' .typography-script .select2-chosen').text($('#'+mainID+' .redux-typography-subsets option:selected').text());if(align){$('#'+mainID+' .typography-preview').css('text-align',align)}if(transform){$('#'+mainID+' .typography-preview').css('text-transform',transform)}if(fontVariant){$('#'+mainID+' .typography-preview').css('font-variant',fontVariant)}if(decoration){$('#'+mainID+' .typography-preview').css('text-decoration',decoration)}$('#'+mainID+' .typography-preview').slideDown()}if(!$('#'+mainID).hasClass('typography-initialized')){$('#'+mainID).addClass('typography-initialized')}isSelecting=false}})(jQuery);