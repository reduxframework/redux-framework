!function(e){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.media=redux.field_objects.media||{};var i;e(document).ready(function(){}),redux.field_objects.media.init=function(d,t){t||(t=!1),d||(d=e(document).find(".redux-group-tab:visible").find(".redux-container-media:visible")),e(d).each(function(){var d=e(this),a=d;d.hasClass("redux-field-container")||(a=d.parents(".redux-field-container:first")),(t||!a.is(":hidden"))&&a.hasClass("redux-field-init")&&(a.removeClass("redux-field-init"),i=!1,d.find(".remove-image, .remove-file").unbind("click").on("click",function(){redux.field_objects.media.removeFile(e(this).parents("fieldset.redux-field:first"))}),d.find(".media_upload_button").unbind().on("click",function(i){redux.field_objects.media.addFile(i,e(this).parents("fieldset.redux-field:first"))}))})},redux.field_objects.media.addFile=function(d,t){d.preventDefault();var a,n,r=e(this);if(a)return void a.open();var o=e(t).find(".library-filter").data("lib-filter");void 0!==o&&""!==o&&(n=[],i=!0,o=decodeURIComponent(o),o=JSON.parse(o),e.each(o,function(e,i){n.push(i)})),a=wp.media({multiple:!1,library:{type:n},title:r.data("choose"),button:{text:r.data("update")}}),a.on("select",function(){var d=a.state().get("selection").first();a.close();var n=e(t).find(".data").data();if(("undefined"==typeof redux.field_objects.media||void 0===typeof redux.field_objects.media)&&(redux.field_objects.media={}),(void 0===n||"undefined"===n.mode)&&(n={},n.mode="image"),i===!0&&(n.mode=0),0===n.mode);else if(n.mode!==!1&&d.attributes.type!==n.mode&&d.attributes.subtype!==n.mode)return;t.find(".upload").val(d.attributes.url),t.find(".upload-id").val(d.attributes.id),t.find(".upload-height").val(d.attributes.height),t.find(".upload-width").val(d.attributes.width),redux_change(e(t).find(".upload-id"));var r=d.attributes.url;if("undefined"!=typeof d.attributes.sizes&&"undefined"!=typeof d.attributes.sizes.thumbnail)r=d.attributes.sizes.thumbnail.url;else if("undefined"!=typeof d.attributes.sizes){var o=d.attributes.height;for(var u in d.attributes.sizes){var s=d.attributes.sizes[u];s.height<o&&(o=s.height,r=s.url)}}else r=d.attributes.icon;t.find(".upload-thumbnail").val(r),t.find(".upload").hasClass("noPreview")||t.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+r+'">').slideDown("fast"),t.find(".remove-image").removeClass("hide"),t.find(".redux-background-properties").slideDown()}),a.open()},redux.field_objects.media.removeFile=function(i){if(i.find(".remove-image").addClass("hide")){i.find(".remove-image").addClass("hide"),i.find(".upload").val(""),i.find(".upload-id").val(""),i.find(".upload-height").val(""),i.find(".upload-width").val(""),i.find(".upload-thumbnail").val(""),redux_change(e(i).find(".upload-id")),i.find(".redux-background-properties").hide();var d=i.find(".screenshot");d.slideUp(),i.find(".remove-file").unbind(),i.find(".section-upload .upload-notice").length>0&&i.find(".media_upload_button").remove()}}}(jQuery);