!function(s){"use strict";var o,c;redux.field_objects=redux.field_objects||{},redux.field_objects.repeater=redux.field_objects.repeater||{},redux.field_objects.repeater.init=function(e){e=e||s(document).find(".redux-group-tab:visible").find(".redux-container-repeater:visible"),s(e).each(function(){var e,r,t=s(this),a=t;(a=!t.hasClass("redux-field-container")?t.parents(".redux-field-container:first"):a).is(":hidden")||a.hasClass("redux-field-init")&&(a.removeClass("redux-field-init"),t.hasClass("redux-field-container")||(a=t.parents(".redux-field-container:first")),r=t.parents(".redux-ajax-security").data("opt-name"),o=void 0===r?redux:redux.optName,e=a.attr("data-id"),r=t.find(".redux-repeater-accordion-repeater:last-child"),o.repeater[e].blank=r.clone().wrap("<p>").parent().html(),a.hasClass("redux-container-repeater")&&a.addClass("redux-field-init"),a.hasClass("redux-field-init")&&(a.removeClass("redux-field-init"),redux.field_objects.repeater.setAccordion(t,e),redux.field_objects.repeater.bindTitle(t),redux.field_objects.repeater.remove(t,e),redux.field_objects.repeater.add(t)))})},redux.field_objects.repeater.add=function(n){String.prototype.reduxReplaceAll=function(e,r){return this.replace(new RegExp(e.replace(/[.^$*+?()[{\|]/g,"\\$&"),"g"),r)},n.find(".redux-repeaters-add").on("click",function(){var e,r,t,a,i,d;redux_change(s(this)),s(this).hasClass("button-disabled")||(r=(e=s(this).parent().find(".redux-repeater-accordion:first")).find(".redux-repeater-accordion-repeater").length,t=e.attr("data-id"),""!==o.repeater[t].limit&&r>=o.repeater[t].limit?s(this).addClass("button-disabled"):(r+=1,a=e.find(".redux-repeater-accordion-repeater").length,e.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").hasClass("ui-state-active")&&e.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").trigger("click"),0===(i=e.find(".redux-repeater-accordion-repeater:last").clone(!0,!0)).length&&(i=o.repeater[t].blank),o.repeater[t]&&(o.repeater[t].count=n.find(".redux-repeater-header").length,d=o.repeater[t].html.reduxReplaceAll("99999",a),s(i).find(".redux-repeater-header").text("")),i.find(".ui-accordion-content").html(d),s(e).append(i),redux.field_objects.repeater.sort_repeaters(i),(i=s(this).parent().find(".redux-repeater-accordion:first")).find(".redux-repeater-accordion-repeater:last .ui-accordion-header").trigger("click"),i.find(".redux-repeater-accordion-repeater:last .bind_title").on("change keyup",function(e){e=0<s(e.target).find(":selected").text().length?s(e.target).find(":selected").text():s(e.target).val();s(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(e)}),s.redux.checkRequired(n),0<o.repeater[t].limit&&r>=o.repeater[t].limit&&s(this).addClass("button-disabled"),!0===c&&2<=r&&n.find(".redux-repeater-accordion").accordion("option",{active:!1}),redux.field_objects.repeater.remove(i)))})},redux.field_objects.repeater.remove=function(t){t.find(".redux-repeaters-remove").on("click",function(){var e,r;redux_change(s(this)),e=s(this).parents(".redux-container-repeater:first"),r=e.attr("data-id"),o.repeater[r].blank=s(this).parents(".redux-repeater-accordion-repeater:first").clone(!0,!0),s(this).parents(".redux-repeater-accordion-repeater:first").slideUp("medium",function(){s(this).remove(),redux.field_objects.repeater.sort_repeaters(t),""!==o.repeater[r].limit&&e.find(".redux-repeater-accordion-repeater").length<o.repeater[r].limit&&e.find(".redux-repeaters-add").removeClass("button-disabled"),e.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").trigger("click")})}),t.find(".redux-repeater-accordion-repeater").hasClass("close-me")&&t.find(".redux-repeaters-remove").trigger("click")},redux.field_objects.repeater.bindTitle=function(e){e.find(".redux-repeater-accordion-repeater .bind_title").on("change keyup",function(e){e=0<s(e.target).find(":selected").text().length?s(e.target).find(":selected").text():s(e.target).val();s(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(e)})},redux.field_objects.repeater.setAccordion=function(i,e){var r=i.find(".redux-repeater-accordion"),r=!0===(c=Boolean(r.data("panels-closed")))?Boolean(!1):parseInt(0),r=i.find(".redux-repeater-accordion").accordion({header:"> div > fieldset > h3",collapsible:!0,active:r,beforeActivate:function(e,r){var t=s(this).next(".redux-repeaters-add").attr("data-name"),a=t.indexOf("[");t.substr(0,a);"function"==typeof reduxRepeaterAccordionBeforeActivate&&reduxRepeaterAccordionBeforeActivate(s(this),i,e,r.optName)},activate:function(e,r){var t,a;s.redux.initFields(),"function"==typeof reduxRepeaterAccordionActivate&&(a=(t=s(this).next(".redux-repeaters-add").attr("data-name")).indexOf("["),a=t.substr(0,a),reduxRepeaterAccordionActivate(s(this),i,e,r,a))},heightStyle:"content",icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}});!0===o.repeater[e].sortable?r.sortable({axis:"y",handle:"h3",placeholder:"ui-state-highlight",start:function(e,r){r.placeholder.height(r.item.height()),r.placeholder.width(r.item.width())},stop:function(e,r){r.item.children("h3").triggerHandler("focusout"),redux.field_objects.repeater.sort_repeaters(s(this))}}):r.find("h3.ui-accordion-header").css("cursor","pointer")},redux.field_objects.repeater.sort_repeaters=function(e){(e=!e.hasClass("redux-container-repeater")?e.parents(".redux-container-repeater:first"):e).find(".redux-repeater-accordion-repeater").each(function(e){var r,t=s(this).attr("data-sortid"),a=s(this).find(".redux-field .repeater[name*='["+t+"]']");a.each(function(){s(this).attr("name",s(this).attr("name").replace("["+t+"]","["+e+"]"))}),(a=s(this).find(".slide-title")).attr("name",a.attr("name").replace("["+t+"]","["+e+"]")),a.attr("data-key",e),s(this).attr("data-sortid",e),a=(r=s(this).find(".ui-accordion-header")).attr("id").split("-header-"),r.attr("id",a[0]+"-header-"+e),a=r.attr("aria-controls").split("-panel-"),r.attr("aria-controls",a[0]+"-panel-"+e),a=(r=s(this).find(".ui-accordion-content")).attr("id").split("-panel-"),r.attr("id",a[0]+"-panel-"+e),a=r.attr("aria-labelledby").split("-header-"),r.attr("aria-labelledby",a[0]+"-header-"+e)})},redux.field_objects.repeater.check_parents_dependencies=function(a){var i="",e=a,r=e.lastIndexOf("-"),d=e.substring(r+1),e=e.replace(d,"99999");return o.required_child.hasOwnProperty(e)?s.each(o.required_child[e],function(e,r){var t;return s("#"+o.args.opt_name+"-"+r.parent+"-"+d).hasClass("hide")?i=!1:!1!==i?(null!==(t=s("#"+o.args.opt_name+"-"+r.parent+"-"+d).serializeForm())&&"object"==typeof t&&t.hasOwnProperty(o.args.opt_name)&&(t=t[o.args.opt_name][r.parent][d]),t=t=s("#"+o.args.opt_name+"-"+a).hasClass("redux-container-media")?t.url:t,i=s.redux.check_dependencies_visibility(t,r),!1):void 0}):i=!0,i},redux_hook(s.redux,"required",function(e,r){s.each(redux.folds,function(e,r){var t,a;-1!==e.indexOf("-99999")&&(e=e.replace("-99999","")),(t=s("[id^="+redux.args.opt_name+"-"+e+"]")).addClass("fold"),"hide"===r&&(t.addClass("hide"),t.hasClass("redux-container-section")&&(a=s("#section-"+e)).hasClass("redux-section-indent-start")&&(s("#section-table-"+e).hide().addClass("hide"),a.hide().addClass("hide")),t.hasClass("redux-container-info")&&s("#info-"+e).hide().addClass("hide"),t.hasClass("redux-container-divide")&&s("#divide-"+e).hide().addClass("hide"),t.hasClass("redux-container-raw")&&t.parents().find("table#"+redux.args.opt_name+"-"+e).hide().addClass("hide"))})}),redux_hook(s.redux,"check_dependencies",function(e,r,t){var a,d,i,n;s(t).hasClass("repeater")&&(a=(i=s(t)).parents(".redux-field:first").data("id"),t=i.parents(".redux-field-container:first"),d=t.hasClass("hide"),i=a.lastIndexOf("-"),t=a.substring(0,i),n=a.substring(i+1),s.each(o.optName.required[t],function(e,r){var t,a,i;-1!==e.indexOf("99999")&&(e=e.replace("99999",n)),t=s(this),a=!1,i=s("#"+o.args.opt_name+"-"+e),!0===(a=!d?redux.field_objects.repeater.check_parents_dependencies(e):a)?i.fadeIn(300,function(){s(this).removeClass("hide"),o.required.hasOwnProperty(e)&&s.redux.check_dependencies(s("#"+o.args.opt_name+"-"+e).children().first()),s.redux.initFields()}):i.fadeOut(100,function(){s(this).addClass("hide"),o.required.hasOwnProperty(e)&&s.redux.required_recursive_hide(e)}),t.find("select, radio, input[type=checkbox]").trigger("change")}))})}(jQuery);