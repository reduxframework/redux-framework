!function(h){"use strict";var x;redux.field_objects=redux.field_objects||{},redux.field_objects.multi_media=redux.field_objects.multi_media||{},redux.field_objects.multi_media.mainID="",redux.field_objects.multi_media.init=function(e){e=e||h(document).find(".redux-group-tab:visible").find(".redux-container-multi_media:visible"),h(e).each(function(){var e=h(this),i=e;(i=e.hasClass("redux-field-container")?i:e.parents(".redux-field-container:first")).is(":hidden")||i.hasClass("redux-field-init")&&(i.removeClass("redux-field-init"),redux.field_objects.multi_media.bindDelete(e),e.find(".redux_upload_button").off().on("click",function(e){redux.field_objects.multi_media.addFile(e,h(this).parents("fieldset.redux-field:first"),h(this))}),redux.field_objects.multi_media.modInit(e))})},redux.field_objects.multi_media.bindDelete=function(e){e.find(".redux_remove_file_button").off("click").on("click",function(e){redux.field_objects.multi_media.removeFile(e,h(this).parents("fieldset.redux-field:first"),h(this))})},redux.field_objects.multi_media.modInit=function(e){x=redux_multi_media_l10,redux.field_objects.multi_media.mainID=e.attr("data-id")},redux.field_objects.multi_media.removeErrMsgs=function(){h("#"+redux.field_objects.multi_media.mainID+" .attach_list li.redux-file-exists").each(function(e,i){h(i).remove()}),h("#"+redux.field_objects.multi_media.mainID+" .attach_list li.redux-max-limit").each(function(e,i){h(i).remove()})},redux.field_objects.multi_media.selExists=function(t){var d=!1;return h("#"+redux.field_objects.multi_media.mainID+" .attach_list li").each(function(e,i){if(0!==h(i).find("input#filelist-"+t).length)return!(d=!0)}),d},redux.field_objects.multi_media.addFile=function(e,n,i){var r,t,m,o=!0,f=i.prev("input").attr("id"),c=h("#"+f),_=c.attr("name");e.preventDefault(),redux.field_objects.multi_media.removeErrMsgs(),i=h(n).find(".library-filter").data("lib-filter"),m=h(n).find(".redux-multi-media-container").data("max-file-upload"),void 0!==i&&""!==i&&(t=[],i=decodeURIComponent(i),i=JSON.parse(i),h.each(i,function(e,i){t.push(i)})),(r=wp.media({multiple:!0,title:x.title,library:{type:t},button:{text:x.upload_file}})).on("select",function(){var t,i=0,d=[],l=[],a=[],s=[],e=r.state().get("selection").toJSON(),u=h("#"+redux.field_objects.multi_media.mainID+" .attach_list").children().length;c.val(e.url),h("#"+f+"_id").val(e.id),h(e).each(function(){var e;return m<=0||i+u<m?redux.field_objects.multi_media.selExists(this.id)?(e=(e=x.dup_warn).replace("%s","<strong>"+this.filename+"</strong>"),o='<li class="redux-file-exists">'+e+"</li>",s.push(o),!(t=!1)):(this.type&&"image"===this.type?(o='<li class="img_status"><img width="50" height="50" src="'+this.url+'" class="attachment-50x50" alt="'+this.filename+'"><p><a href="#" class="redux_remove_file_button" rel="'+f+"["+this.id+']">'+x.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" name="'+_+"["+this.id+']" value="'+this.url+'"></li>',a.push(o),t=!0):(o="<li>"+x.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+x.download+'</a> / <a href="#" class="redux_remove_file_button" rel="'+f+"["+this.id+']">'+x.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" name="'+_+"["+this.id+']" value="'+this.url+'"></li>',l.push(o)),void(i+=1)):(e=(e=x.max_warn).replace("%s","<strong>"+m+"</strong>"),o='<li class="redux-max-limit">'+e+"</li>",s.push(o),!1)}),h.isEmptyObject(a)||h(a).each(function(e,i){d.push(i),t=!0}),h.isEmptyObject(l)||h(l).each(function(e,i){d.push(i),t=!0}),h.isEmptyObject(s)||h(s).each(function(e,i){d.push(i)}),h(d).each(function(){c.siblings(".redux_media_status").slideDown().append(this)}),r.close(),!0===t&&(redux.field_objects.multi_media.bindDelete(n),redux_change(h(n).find(".redux_media_status")))}),r.open()},redux.field_objects.multi_media.removeFile=function(e,i,t){var d;return e.preventDefault(),t.is(".attach_list .redux_remove_file_button")?(t.parents("li").remove(),redux_change(h(i).find(".redux_media_status"))):(e=t.attr("rel"),d=t.parents(".img_status"),i.find("input#"+e).val(""),i.find("input#"+e+"_id").val(""),(d.length?d:t.parents(".redux_media_status")).html("")),!1}}(jQuery);